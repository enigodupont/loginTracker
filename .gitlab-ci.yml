build_image:
  script:
    - docker login -u="$GIT_USER" -p="$GIT_PASS" 
    - "docker build -t logintracker:build ."
    - "docker tag logintracker:build jc6482/logintracker:latest"
    - "docker push jc6482/logintracker:latest"
    - "docker rmi -f logintracker:build jc6482/logintracker:latest || true"
    - docker logout
    
sonar_scan:
  script:
    - "/opt/sonar-scanner/bin/sonar-scanner -Dsonar.projectKey=LOGINTRACKER -Dsonar.sources=. -Dsonar.exclusions=loginTrackerServer/env/**,loginTrackerServer/linuxEnv/**,loginTrackerServer/static/**,loginTrackerServer/app/static/**  -Dsonar.host.url=http://10.64.0.5:30900 -Dsonar.login=$SONAR_TOKEN"

kube_deploy:
  script:
    - "/usr/bin/kubectl apply -f deployment.yaml"

